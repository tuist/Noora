.noora-date-picker {
  /* Component-level semantic colors */
  --noora-datepicker-range-background: light-dark(
    var(--noora-purple-50),
    oklch(from var(--noora-purple-500) l c h / 0.24)
  );
  --noora-datepicker-selected-background: var(--noora-purple-500);
  --noora-datepicker-selected-text: var(--noora-neutral-light-50);
  --noora-datepicker-range-text: light-dark(
    var(--noora-purple-500),
    var(--noora-purple-400)
  );
  --noora-datepicker-today-marker: light-dark(
    var(--noora-purple-500),
    var(--noora-purple-400)
  );
  --noora-datepicker-preset-hover-background: light-dark(
    var(--noora-neutral-light-200),
    var(--noora-neutral-dark-1000)
  );
  --noora-datepicker-trigger-background: light-dark(
    var(--noora-neutral-light-50),
    var(--noora-neutral-dark-1100)
  );

  display: flex;
  flex-direction: column;
  position: relative;
  font: var(--noora-font-body-small);
}

/* Trigger button */
.noora-date-picker [data-part="trigger"] {
  --background-base: var(--noora-datepicker-trigger-background);
  --background-gradient-start: light-dark(
    oklch(78.6% 0.013 248 / 0),
    oklch(100% 0 0 / 0.08)
  );
  --background-gradient-end: light-dark(
    oklch(78.6% 0.013 248 / 0.13),
    oklch(100% 0 0 / 0)
  );

  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--noora-spacing-4);
  cursor: pointer;
  outline: unset;
  box-shadow: var(--noora-border-light-default);
  border: 0;
  border-radius: var(--noora-radius-medium);
  background:
    linear-gradient(
      180deg,
      var(--background-gradient-start) 0%,
      var(--background-gradient-end) 100%
    ),
    var(--background-base);
  padding: var(--noora-spacing-3) var(--noora-spacing-4);
  color: var(--noora-surface-label-primary);
  font: var(--noora-font-body-medium);
  width: fit-content;

  &:hover:not(:disabled) {
    --background-gradient-start: light-dark(
      oklch(78.6% 0.013 248 / 0),
      oklch(100% 0 0 / 0.04)
    );
    --background-gradient-end: light-dark(
      oklch(78.6% 0.013 248 / 0.26),
      oklch(100% 0 0 / 0)
    );
  }

  &:disabled {
    cursor: not-allowed;
    color: var(--noora-surface-label-disabled);
  }

  &[data-state="open"] {
    box-shadow: var(--noora-border-light-focus);
  }
}

.noora-date-picker [data-part="trigger-label"] {
  font-weight: var(--noora-font-weight-medium);
}

.noora-date-picker [data-part="trigger-icon"] {
  display: inline-flex;
  color: var(--noora-button-secondary-label);
  width: var(--noora-icon-size-large);
  height: var(--noora-icon-size-large);

  & svg {
    width: 100%;
    height: 100%;
  }
}

/* Positioner - Zag handles visibility via hidden attribute */
.noora-date-picker [data-part="positioner"] {
  /* Zag sets inline positioning styles */
  /* Adjust horizontal position to the left */
  margin-left: calc(-1 * var(--noora-spacing-2));

  /* Prevent flashing of the component before script load */
  &:not(:has(> [data-state])) {
    display: none;
  }
}

/* Ensure hidden attribute works (overrides display: flex on children) */
.noora-date-picker [data-part="positioner"][hidden],
.noora-date-picker [data-part="content"][hidden] {
  display: none;
}

/* Content container (the dropdown panel) */
.noora-date-picker [data-part="content"] {
  display: flex;
  flex-direction: row;
  background: var(--noora-surface-background-primary);
  box-shadow: var(--noora-border-medium);
  border-radius: var(--noora-radius-large);
  overflow: hidden;
}

.noora-date-picker [data-part="content"] {
  background-color: var(--noora-surface-background-tertiary);
  box-shadow: var(--noora-border-light-default);
}

/* Desktop layout */
@media (min-width: 768px) {
  .noora-date-picker [data-part="content"] {
    flex-direction: row;
  }

  .noora-date-picker [data-part="presets"][data-device="mobile"] {
    display: none;
  }

  .noora-date-picker [data-part="presets"][data-device="desktop"] {
    display: flex;
  }

  .noora-date-picker [data-part="month"][data-desktop-only] {
    display: flex;
  }
}

/* Mobile layout */
@media (max-width: 767px) {
  .noora-date-picker [data-part="positioner"] {
    /* Reset desktop offset and align to available space */
    margin-left: 0;
  }

  .noora-date-picker [data-part="content"] {
    /* Use Zag's --available-width variable to constrain to parent bounds */
    flex-direction: column;
    width: var(--available-width);
    max-width: var(--available-width);
    min-width: 0;
    overflow: hidden;
    box-sizing: border-box;
  }

  .noora-date-picker [data-part="presets"][data-device="desktop"] {
    display: none;
  }

  .noora-date-picker [data-part="presets"][data-device="mobile"] {
    display: flex;
    overflow-x: auto;
    flex-shrink: 0;
  }

  .noora-date-picker [data-part="presets"][data-device="mobile"] [data-part="preset-item"] {
    flex-shrink: 0;
  }

  .noora-date-picker [data-part="month"][data-desktop-only] {
    display: none;
  }

  .noora-date-picker [data-part="calendar"] {
    width: 100%;
    max-width: 100%;
    min-width: 0;
    overflow: hidden;
    box-sizing: border-box;
  }

  .noora-date-picker [data-part="months"] {
    width: 100%;
    max-width: 100%;
    min-width: 0;
    overflow: hidden;
  }

  .noora-date-picker [data-part="month"] {
    width: 100%;
    max-width: 100%;
    min-width: 0;
    box-sizing: border-box;
    padding: var(--noora-spacing-4);
  }

  .noora-date-picker [data-part="table"] {
    width: 100%;
    table-layout: fixed;
  }

  .noora-date-picker [data-part="table-head"] th {
    width: auto;
    padding: var(--noora-spacing-1);
  }

  .noora-date-picker [data-part="table-body"] td {
    padding: var(--noora-spacing-1);
  }

  .noora-date-picker [data-part="table-cell-trigger"] {
    width: 100%;
    min-width: 28px;
    height: 28px;
  }

  .noora-date-picker [data-part="footer"] {
    flex-direction: column;
    gap: var(--noora-spacing-7);
    padding: var(--noora-spacing-4);
  }

  .noora-date-picker [data-part="range-display"] {
    width: 100%;
    justify-content: center;
  }

  .noora-date-picker [data-part="footer"] [data-part="actions"] {
    display: flex;
    flex-direction: row;
    width: 100%;
    justify-content: flex-end;
    gap: var(--noora-spacing-3);
  }
}

/* Desktop preset sidebar */
.noora-date-picker [data-part="presets"][data-device="desktop"] {
  flex-direction: column;
  gap: var(--noora-spacing-5);
  padding: var(--noora-spacing-6) var(--noora-spacing-2);
  width: 140px;
  flex-shrink: 0;
}

/* Mobile preset tabs */
.noora-date-picker [data-part="presets"][data-device="mobile"] {
  flex-direction: row;
  gap: var(--noora-spacing-2);
  padding: var(--noora-spacing-4);
  overflow-x: auto;
  border-bottom: 1px solid var(--noora-content-divider-line);

  /* Hide scrollbar */
  scrollbar-width: none;
  -ms-overflow-style: none;

  &::-webkit-scrollbar {
    display: none;
  }
}

/* Preset items */
.noora-date-picker [data-part="preset-item"] {
  display: flex;
  align-items: center;
  cursor: pointer;
  border: 0;
  border-radius: var(--noora-radius-medium);
  background: transparent;
  padding: var(--noora-spacing-2) var(--noora-spacing-4);
  color: var(--noora-surface-label-secondary);
  font: var(--noora-font-body-small);
  white-space: nowrap;
  transition: background-color 0.15s ease;

  &:hover {
    background: var(--noora-datepicker-preset-hover-background);
  }

  &[data-selected="true"] {
    background: var(--noora-datepicker-range-background);
    color: var(--noora-datepicker-range-text);
  }
}

/* Calendar area container */
.noora-date-picker [data-part="calendar"] {
  display: flex;
  flex-direction: column;
  gap: var(--noora-spacing-3);
  overflow: hidden;
  box-shadow: var(--noora-border-light-default);
  border-top-left-radius: var(--noora-radius-xlarge);
  border-bottom-left-radius: var(--noora-radius-xlarge);
  background-color: var(--noora-surface-background-primary);
}

/* Months container */
.noora-date-picker [data-part="months"] {
  display: flex;
  gap: var(--noora-spacing-4);
}

/* Individual month */
.noora-date-picker [data-part="month"] {
  display: flex;
  flex-direction: column;
  gap: var(--noora-spacing-5);
  padding: var(--noora-spacing-6);
}

/* Month navigation header */
.noora-date-picker [data-part="view-control"] {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.noora-date-picker [data-part="prev-trigger"],
.noora-date-picker [data-part="next-trigger"] {
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: 0;
  border-radius: var(--noora-radius-medium);
  background: transparent;
  padding: var(--noora-spacing-1);
  width: var(--noora-icon-size-large);
  height: var(--noora-icon-size-large);
  color: var(--noora-surface-label-primary);

  &:hover {
    background: var(--noora-datepicker-preset-hover-background);
  }

  &:disabled,
  &[data-disabled] {
    visibility: hidden;
  }

  & svg {
    width: 100%;
    height: 100%;
  }
}

.noora-date-picker [data-part="view-trigger"] {
  font: var(--noora-font-body-small);
  font-weight: var(--noora-font-weight-medium);
  color: var(--noora-surface-label-primary);
}

/* Calendar table */
.noora-date-picker [data-part="table"] {
  border-collapse: collapse;
  border-spacing: 0;
}

.noora-date-picker [data-part="table-head"] {
  & th {
    font: var(--noora-font-body-small);
    font-weight: var(--noora-font-weight-medium);
    color: var(--noora-surface-label-secondary);
    padding: var(--noora-spacing-2);
    width: 30px;
    height: 30px;
    text-align: center;
  }
}

.noora-date-picker [data-part="table-body"] {
  & td {
    padding: var(--noora-spacing-2);
    position: relative;
  }
}

/* Day cell */
.noora-date-picker [data-part="table-cell"] {
  position: relative;
}

/* Range/hover-range background - shown behind cells in range or during hover preview */
/* Uses :has() to target td when its child button has data-in-range or data-in-hover-range */
/* Excludes cells with hidden/outside-range/disabled children */
.noora-date-picker
  [data-part="table-cell"]:has([data-in-range]):not(
    :has([data-outside-range])
  ):not([data-hidden])::before,
.noora-date-picker
  [data-part="table-cell"]:has([data-in-hover-range]):not(
    :has([data-outside-range])
  ):not(:has([data-disabled])):not(:has([data-selected]))::before {
  content: "";
  position: absolute;
  /* Match the height of table-cell-trigger (30px) and center vertically */
  height: 30px;
  top: 50%;
  transform: translateY(-50%);
  left: 0;
  right: 0;
  background: var(--noora-datepicker-range-background);
}

/* Range start (non-selected) - add rounded left corners and left padding */
.noora-date-picker
  [data-part="table-cell"]:has([data-range-start]:not([data-selected])):not(
    :has([data-outside-range])
  )::before {
  left: var(--noora-spacing-2);
  border-top-left-radius: var(--noora-radius-medium);
  border-bottom-left-radius: var(--noora-radius-medium);
}

/* Range end (non-selected) - add rounded right corners and right padding */
.noora-date-picker
  [data-part="table-cell"]:has([data-range-end]:not([data-selected])):not(
    :has([data-outside-range])
  )::before {
  right: var(--noora-spacing-2);
  border-top-right-radius: var(--noora-radius-medium);
  border-bottom-right-radius: var(--noora-radius-medium);
}

/* Selected cells - collapse ::before to zero width by default, no radius */
/* Higher specificity to override base in-range rule */
.noora-date-picker
  [data-part="table-cell"]:has([data-in-range]):has([data-selected]):not(
    :has([data-outside-range])
  ):not([data-hidden])::before {
  left: 50%;
  right: 50%;
  border-radius: 0;
}

/* Selected with hover-range-start (not hover-range-end) - show right half */
.noora-date-picker
  [data-part="table-cell"]:has(
    [data-selected][data-hover-range-start]:not([data-hover-range-end])
  ):not(:has([data-outside-range])):not([data-hidden])::before {
  right: 0;
}

/* Selected with hover-range-end (not hover-range-start) - show left half */
.noora-date-picker
  [data-part="table-cell"]:has(
    [data-selected][data-hover-range-end]:not([data-hover-range-start])
  ):not(:has([data-outside-range])):not([data-hidden])::before {
  left: 0;
}

/* Selected range-start (not also range-end, no hover attrs) - show right half */
.noora-date-picker
  [data-part="table-cell"]:has(
    [data-selected][data-range-start]:not([data-range-end]):not(
        [data-hover-range-start]
      ):not([data-hover-range-end])
  ):not(:has([data-outside-range])):not([data-hidden])::before {
  right: 0;
}

/* Selected range-end (not also range-start, no hover attrs) - show left half */
.noora-date-picker
  [data-part="table-cell"]:has(
    [data-selected][data-range-end]:not([data-range-start]):not(
        [data-hover-range-start]
      ):not([data-hover-range-end])
  ):not(:has([data-outside-range])):not([data-hidden])::before {
  left: 0;
}

/* First cell in row that's in range/hover-range - add rounded left corners and left padding */
.noora-date-picker
  [data-part="table-cell"]:first-child:has([data-in-range]):not(
    :has([data-outside-range])
  ):not([data-hidden])::before,
.noora-date-picker
  [data-part="table-cell"]:first-child:has([data-in-hover-range]):not(
    :has([data-outside-range])
  ):not(:has([data-disabled])):not(:has([data-selected]))::before {
  left: var(--noora-spacing-2);
  border-top-left-radius: var(--noora-radius-medium);
  border-bottom-left-radius: var(--noora-radius-medium);
}

/* Cell preceded by hidden cell - treat as first visible, add rounded left corners and left padding */
.noora-date-picker
  [data-part="day-table-cell"][data-hidden]
  + [data-part="table-cell"]:has([data-in-range]):not([data-hidden])::before {
  left: var(--noora-spacing-2);
  border-top-left-radius: var(--noora-radius-medium);
  border-bottom-left-radius: var(--noora-radius-medium);
}

/* Last cell in row that's in range/hover-range - add rounded right corners and right padding */
.noora-date-picker
  [data-part="table-cell"]:last-child:has([data-in-range]):not(
    :has([data-outside-range])
  ):not([data-hidden])::before,
.noora-date-picker
  [data-part="table-cell"]:last-child:has([data-in-hover-range]):not(
    :has([data-outside-range])
  ):not(:has([data-disabled])):not(:has([data-selected]))::before {
  right: var(--noora-spacing-2);
  border-top-right-radius: var(--noora-radius-medium);
  border-bottom-right-radius: var(--noora-radius-medium);
}

/* Cell followed by hidden cell - treat as last visible, add rounded right corners and right padding */
.noora-date-picker
  [data-part="table-cell"]:has([data-in-range]):not([data-hidden]):has(
    + [data-part="day-table-cell"][data-hidden]
  )::before {
  right: var(--noora-spacing-2);
  border-top-right-radius: var(--noora-radius-medium);
  border-bottom-right-radius: var(--noora-radius-medium);
}

/* First hover-range cell in row - add rounded left corners and left padding */
.noora-date-picker
  [data-part="table-cell"]:has(
    [data-in-hover-range]:not([data-outside-range]):not([data-disabled]):not(
        [data-selected]
      )
  )::before {
  left: var(--noora-spacing-2);
  border-top-left-radius: var(--noora-radius-medium);
  border-bottom-left-radius: var(--noora-radius-medium);
}

/* Override: hover-range cells preceded by another hover-range - remove left padding/radius */
.noora-date-picker
  [data-part="table-cell"]:has([data-in-hover-range])
  + [data-part="table-cell"]:has(
    [data-in-hover-range]:not([data-outside-range]):not([data-disabled]):not(
        [data-selected]
      )
  )::before {
  left: 0;
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}

/* Hover range end - add rounded right corners and right padding */
.noora-date-picker
  [data-part="table-cell"]:has([data-hover-range-end]):not(
    :has([data-outside-range])
  )::before {
  right: var(--noora-spacing-2);
  border-top-right-radius: var(--noora-radius-medium);
  border-bottom-right-radius: var(--noora-radius-medium);
}

/* Day cell trigger (button) */
.noora-date-picker [data-part="table-cell-trigger"] {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  cursor: pointer;
  border: 0;
  border-radius: var(--noora-radius-medium);
  background: transparent;
  width: 30px;
  height: 30px;
  font: var(--noora-font-body-small);
  color: var(--noora-surface-label-secondary);
  transition:
    background-color 0.15s ease,
    color 0.15s ease;

  &:hover:not([data-disabled]):not([data-unavailable]):not([data-selected]) {
    background: var(--noora-datepicker-preset-hover-background);
  }

  /* In range state (confirmed selection) */
  &[data-in-range]:not([data-selected]) {
    color: var(--noora-datepicker-range-text);
  }

  /* Hover range state (hover preview during range selection) */
  &[data-in-hover-range]:not([data-selected]):not([data-disabled]) {
    color: var(--noora-datepicker-range-text);
  }

  /* Selected state (start/end of range) */
  &[data-selected] {
    background: var(--noora-datepicker-selected-background);
    color: var(--noora-datepicker-selected-text);
    box-shadow: var(--noora-button-border-primary);

    &::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0px 1px 0px 0px oklch(100% 0 0 / 0.2);
      pointer-events: none;
    }
  }

  /* Today marker */
  &[data-today]::after {
    content: "";
    position: absolute;
    bottom: 4px;
    left: 50%;
    transform: translateX(-50%);
    width: 8px;
    height: 2px;
    background: var(--noora-datepicker-today-marker);
    border-radius: var(--noora-radius-max);
  }

  &[data-today][data-selected]::after {
    background: var(--noora-datepicker-selected-text);
  }

  /* Disabled state */
  &[data-disabled],
  &[data-unavailable] {
    color: var(--noora-surface-label-disabled);
    cursor: not-allowed;
  }

  /* Outside current month - hide completely */
  &[data-outside-range] {
    visibility: hidden;
  }
}

/* Disable trigger hover background when in range selection mode (except for selected elements) */
.noora-date-picker[data-selecting-range]
  [data-part="table-cell-trigger"]:hover:not([data-disabled]):not(
    [data-unavailable]
  ):not([data-selected]) {
  background-color: transparent;
}

/* Disable trigger hover background for in-range cells (except range start/end) */
.noora-date-picker
  [data-part="table-cell-trigger"][data-in-range]:not([data-range-start]):not(
    [data-range-end]
  ):hover {
  background-color: transparent;
}

/* Footer section */
.noora-date-picker [data-part="footer"] {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--noora-spacing-6);
}

/* Range display */
.noora-date-picker [data-part="range-display"] {
  display: flex;
  align-items: center;
  gap: var(--noora-spacing-4);
}

.noora-date-picker [data-part="date-display"] {
  display: flex;
  align-items: center;
  gap: var(--noora-spacing-1);
  box-shadow: var(--noora-border-light-default);
  border-radius: var(--noora-radius-medium);
  background: var(--noora-surface-background-primary);
  padding: var(--noora-spacing-1);
}

.noora-date-picker [data-part="date-display"]:focus-within {
  box-shadow: var(--noora-border-light-focus);
}

.noora-date-picker [data-part="date-input"] {
  border: 0;
  background: transparent;
  padding: var(--noora-spacing-1);
  font: var(--noora-font-body-small);
  color: var(--noora-surface-label-primary);
  text-align: center;

  &[data-field="day"],
  &[data-field="month"] {
    width: 24px;
  }

  &[data-field="year"] {
    width: 40px;
  }

  &::placeholder {
    color: var(--noora-surface-label-tertiary);
  }

  &:focus {
    outline: none;
  }

  &:disabled {
    cursor: not-allowed;
    color: var(--noora-surface-label-disabled);
  }
}

.noora-date-picker [data-part="date-separator"] {
  color: var(--noora-surface-label-primary);
  font: var(--noora-font-weight-regular) var(--noora-font-body-small);
}

.noora-date-picker [data-part="arrow"] {
  color: var(--noora-surface-label-secondary);
  width: var(--noora-icon-size-medium);
  height: var(--noora-icon-size-medium);

  & svg {
    width: 100%;
    height: 100%;
  }
}

/* Actions */
.noora-date-picker [data-part="actions"] {
  display: flex;
  align-items: center;
  gap: var(--noora-spacing-4);
}

.noora-date-picker [data-part="cancel"],
.noora-date-picker [data-part="apply"] {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--noora-spacing-1);
  cursor: pointer;
  border: 0;
  border-radius: var(--noora-radius-medium);
  padding: var(--noora-spacing-3) var(--noora-spacing-4);
  font: var(--noora-font-body-small);
  font-weight: var(--noora-font-weight-medium);
  transition: background-color 0.15s ease;
}

.noora-date-picker [data-part="cancel"] {
  background: var(--noora-button-background-secondary);
  box-shadow: var(--noora-button-border-secondary);
  color: var(--noora-button-secondary-label);

  &:hover {
    background: var(--noora-button-background-secondary-hover);
  }
}

.noora-date-picker [data-part="apply"] {
  background: var(--noora-button-background-primary);
  box-shadow: var(--noora-button-border-primary);
  color: var(--noora-button-primary-label);

  &:hover {
    background: var(--noora-button-background-primary-hover);
    box-shadow: var(--noora-button-border-primary-hover);
  }
}
